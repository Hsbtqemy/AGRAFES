{
  "components": {
    "schemas": {
      "AlignAuditRequest": {
        "additionalProperties": false,
        "properties": {
          "external_id": {
            "type": "integer"
          },
          "limit": {
            "default": 50,
            "maximum": 200,
            "minimum": 1,
            "type": "integer"
          },
          "offset": {
            "default": 0,
            "minimum": 0,
            "type": "integer"
          },
          "pivot_doc_id": {
            "type": "integer"
          },
          "target_doc_id": {
            "type": "integer"
          }
        },
        "required": [
          "pivot_doc_id",
          "target_doc_id"
        ],
        "type": "object"
      },
      "AlignAuditResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "has_more": {
                "type": "boolean"
              },
              "limit": {
                "type": "integer"
              },
              "links": {
                "items": {
                  "$ref": "#/components/schemas/AlignLinkRecord"
                },
                "type": "array"
              },
              "next_offset": {
                "nullable": true,
                "type": "integer"
              },
              "offset": {
                "type": "integer"
              },
              "pivot_doc_id": {
                "type": "integer"
              },
              "stats": {
                "properties": {
                  "links_returned": {
                    "type": "integer"
                  }
                },
                "type": "object"
              },
              "target_doc_id": {
                "type": "integer"
              }
            },
            "required": [
              "pivot_doc_id",
              "target_doc_id",
              "limit",
              "offset",
              "has_more",
              "next_offset",
              "stats",
              "links"
            ],
            "type": "object"
          }
        ]
      },
      "AlignLinkDeleteRequest": {
        "properties": {
          "link_id": {
            "type": "integer"
          }
        },
        "required": [
          "link_id"
        ],
        "type": "object"
      },
      "AlignLinkRecord": {
        "additionalProperties": false,
        "properties": {
          "external_id": {
            "nullable": true,
            "type": "integer"
          },
          "link_id": {
            "type": "integer"
          },
          "pivot_text": {
            "type": "string"
          },
          "pivot_unit_id": {
            "type": "integer"
          },
          "target_text": {
            "type": "string"
          },
          "target_unit_id": {
            "type": "integer"
          }
        },
        "required": [
          "link_id",
          "pivot_unit_id",
          "target_unit_id",
          "pivot_text",
          "target_text"
        ],
        "type": "object"
      },
      "AlignLinkRetargetRequest": {
        "properties": {
          "link_id": {
            "type": "integer"
          },
          "new_target_unit_id": {
            "type": "integer"
          }
        },
        "required": [
          "link_id",
          "new_target_unit_id"
        ],
        "type": "object"
      },
      "AlignLinkUpdateStatusRequest": {
        "properties": {
          "link_id": {
            "type": "integer"
          },
          "status": {
            "enum": [
              "accepted",
              "rejected"
            ],
            "nullable": true,
            "type": "string"
          }
        },
        "required": [
          "link_id",
          "status"
        ],
        "type": "object"
      },
      "AlignQualityRequest": {
        "additionalProperties": false,
        "properties": {
          "pivot_doc_id": {
            "type": "integer"
          },
          "run_id": {
            "nullable": true,
            "type": "string"
          },
          "target_doc_id": {
            "type": "integer"
          }
        },
        "required": [
          "pivot_doc_id",
          "target_doc_id"
        ],
        "type": "object"
      },
      "AlignQualityResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "pivot_doc_id": {
                "type": "integer"
              },
              "run_id": {
                "nullable": true,
                "type": "string"
              },
              "sample_orphan_pivot": {
                "items": {
                  "type": "object"
                },
                "type": "array"
              },
              "sample_orphan_target": {
                "items": {
                  "type": "object"
                },
                "type": "array"
              },
              "stats": {
                "properties": {
                  "collision_count": {
                    "type": "integer"
                  },
                  "coverage_pct": {
                    "type": "number"
                  },
                  "covered_pivot_units": {
                    "type": "integer"
                  },
                  "covered_target_units": {
                    "type": "integer"
                  },
                  "orphan_pivot_count": {
                    "type": "integer"
                  },
                  "orphan_target_count": {
                    "type": "integer"
                  },
                  "status_counts": {
                    "properties": {
                      "accepted": {
                        "type": "integer"
                      },
                      "rejected": {
                        "type": "integer"
                      },
                      "unreviewed": {
                        "type": "integer"
                      }
                    },
                    "type": "object"
                  },
                  "total_links": {
                    "type": "integer"
                  },
                  "total_pivot_units": {
                    "type": "integer"
                  },
                  "total_target_units": {
                    "type": "integer"
                  }
                },
                "required": [
                  "total_pivot_units",
                  "total_target_units",
                  "total_links",
                  "covered_pivot_units",
                  "covered_target_units",
                  "coverage_pct",
                  "orphan_pivot_count",
                  "orphan_target_count",
                  "collision_count",
                  "status_counts"
                ],
                "type": "object"
              },
              "target_doc_id": {
                "type": "integer"
              }
            },
            "required": [
              "pivot_doc_id",
              "target_doc_id",
              "stats"
            ],
            "type": "object"
          }
        ]
      },
      "AlignRequest": {
        "additionalProperties": false,
        "properties": {
          "debug_align": {
            "default": false,
            "type": "boolean"
          },
          "pivot_doc_id": {
            "type": "integer"
          },
          "relation_type": {
            "default": "translation",
            "type": "string"
          },
          "run_id": {
            "type": "string"
          },
          "sim_threshold": {
            "default": 0.8,
            "maximum": 1.0,
            "minimum": 0.0,
            "type": "number"
          },
          "strategy": {
            "default": "external_id",
            "enum": [
              "external_id",
              "position",
              "similarity",
              "external_id_then_position"
            ],
            "type": "string"
          },
          "target_doc_ids": {
            "items": {
              "type": "integer"
            },
            "minItems": 1,
            "type": "array"
          }
        },
        "required": [
          "pivot_doc_id",
          "target_doc_ids"
        ],
        "type": "object"
      },
      "AlignResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "debug_align": {
                "type": "boolean"
              },
              "pivot_doc_id": {
                "type": "integer"
              },
              "reports": {
                "items": {
                  "type": "object"
                },
                "type": "array"
              },
              "run_id": {
                "type": "string"
              },
              "strategy": {
                "type": "string"
              },
              "total_links_created": {
                "type": "integer"
              }
            },
            "required": [
              "run_id",
              "strategy",
              "pivot_doc_id",
              "reports"
            ],
            "type": "object"
          }
        ]
      },
      "BaseResponse": {
        "additionalProperties": true,
        "properties": {
          "api_version": {
            "type": "string"
          },
          "ok": {
            "type": "boolean"
          },
          "status": {
            "type": "string"
          },
          "version": {
            "type": "string"
          }
        },
        "required": [
          "ok",
          "api_version",
          "version",
          "status"
        ],
        "type": "object"
      },
      "CuratePreviewExample": {
        "additionalProperties": false,
        "properties": {
          "after": {
            "type": "string"
          },
          "before": {
            "type": "string"
          },
          "external_id": {
            "nullable": true,
            "type": "integer"
          },
          "unit_id": {
            "type": "integer"
          }
        },
        "required": [
          "unit_id",
          "before",
          "after"
        ],
        "type": "object"
      },
      "CuratePreviewRequest": {
        "additionalProperties": false,
        "properties": {
          "doc_id": {
            "type": "integer"
          },
          "limit_examples": {
            "default": 10,
            "maximum": 50,
            "minimum": 1,
            "type": "integer"
          },
          "rules": {
            "items": {
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "doc_id",
          "rules"
        ],
        "type": "object"
      },
      "CuratePreviewResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "doc_id": {
                "type": "integer"
              },
              "examples": {
                "items": {
                  "$ref": "#/components/schemas/CuratePreviewExample"
                },
                "type": "array"
              },
              "fts_stale": {
                "type": "boolean"
              },
              "stats": {
                "properties": {
                  "replacements_total": {
                    "type": "integer"
                  },
                  "units_changed": {
                    "type": "integer"
                  },
                  "units_total": {
                    "type": "integer"
                  }
                },
                "required": [
                  "units_total",
                  "units_changed",
                  "replacements_total"
                ],
                "type": "object"
              }
            },
            "required": [
              "doc_id",
              "stats",
              "examples"
            ],
            "type": "object"
          }
        ]
      },
      "CurateRequest": {
        "additionalProperties": false,
        "properties": {
          "doc_id": {
            "type": "integer"
          },
          "rules": {
            "items": {
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "rules"
        ],
        "type": "object"
      },
      "CurateResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "docs_curated": {
                "type": "integer"
              },
              "fts_stale": {
                "type": "boolean"
              },
              "results": {
                "items": {
                  "type": "object"
                },
                "type": "array"
              },
              "units_modified": {
                "type": "integer"
              }
            },
            "required": [
              "docs_curated",
              "units_modified",
              "fts_stale",
              "results"
            ],
            "type": "object"
          }
        ]
      },
      "DocRelationRecord": {
        "properties": {
          "created_at": {
            "type": "string"
          },
          "doc_id": {
            "type": "integer"
          },
          "id": {
            "type": "integer"
          },
          "note": {
            "nullable": true,
            "type": "string"
          },
          "relation_type": {
            "type": "string"
          },
          "target_doc_id": {
            "type": "integer"
          }
        },
        "type": "object"
      },
      "DocRelationSetRequest": {
        "properties": {
          "doc_id": {
            "type": "integer"
          },
          "note": {
            "nullable": true,
            "type": "string"
          },
          "relation_type": {
            "type": "string"
          },
          "target_doc_id": {
            "type": "integer"
          }
        },
        "required": [
          "doc_id",
          "relation_type",
          "target_doc_id"
        ],
        "type": "object"
      },
      "DocumentBulkUpdateRequest": {
        "properties": {
          "updates": {
            "items": {
              "$ref": "#/components/schemas/DocumentUpdateRequest"
            },
            "type": "array"
          }
        },
        "required": [
          "updates"
        ],
        "type": "object"
      },
      "DocumentRecord": {
        "additionalProperties": false,
        "properties": {
          "doc_id": {
            "type": "integer"
          },
          "doc_role": {
            "nullable": true,
            "type": "string"
          },
          "language": {
            "type": "string"
          },
          "resource_type": {
            "nullable": true,
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "unit_count": {
            "type": "integer"
          }
        },
        "required": [
          "doc_id",
          "title",
          "language",
          "unit_count"
        ],
        "type": "object"
      },
      "DocumentUpdateRequest": {
        "properties": {
          "doc_id": {
            "type": "integer"
          },
          "doc_role": {
            "type": "string"
          },
          "language": {
            "type": "string"
          },
          "resource_type": {
            "type": "string"
          },
          "title": {
            "type": "string"
          }
        },
        "required": [
          "doc_id"
        ],
        "type": "object"
      },
      "DocumentsResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "count": {
                "type": "integer"
              },
              "documents": {
                "items": {
                  "$ref": "#/components/schemas/DocumentRecord"
                },
                "type": "array"
              }
            },
            "required": [
              "documents",
              "count"
            ],
            "type": "object"
          }
        ]
      },
      "ErrorResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "error": {
                "properties": {
                  "details": {},
                  "message": {
                    "type": "string"
                  },
                  "type": {
                    "type": "string"
                  }
                },
                "required": [
                  "type",
                  "message"
                ],
                "type": "object"
              },
              "error_code": {
                "type": "string"
              },
              "error_details": {},
              "error_message": {
                "type": "string"
              }
            },
            "required": [
              "error",
              "error_code"
            ],
            "type": "object"
          }
        ]
      },
      "ExportAlignCsvRequest": {
        "properties": {
          "delimiter": {
            "default": ",",
            "type": "string"
          },
          "out_path": {
            "type": "string"
          },
          "pivot_doc_id": {
            "nullable": true,
            "type": "integer"
          },
          "target_doc_id": {
            "nullable": true,
            "type": "integer"
          }
        },
        "required": [
          "out_path"
        ],
        "type": "object"
      },
      "ExportRunReportRequest": {
        "properties": {
          "format": {
            "default": "jsonl",
            "enum": [
              "jsonl",
              "html"
            ],
            "type": "string"
          },
          "out_path": {
            "type": "string"
          },
          "run_id": {
            "nullable": true,
            "type": "string"
          }
        },
        "required": [
          "out_path"
        ],
        "type": "object"
      },
      "ExportTeiRequest": {
        "properties": {
          "doc_ids": {
            "items": {
              "type": "integer"
            },
            "nullable": true,
            "type": "array"
          },
          "out_dir": {
            "type": "string"
          }
        },
        "required": [
          "out_dir"
        ],
        "type": "object"
      },
      "HealthResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "host": {
                "type": "string"
              },
              "pid": {
                "type": "integer"
              },
              "port": {
                "type": "integer"
              },
              "portfile": {
                "type": "string"
              },
              "started_at": {
                "type": "string"
              }
            },
            "required": [
              "version",
              "pid",
              "started_at"
            ],
            "type": "object"
          }
        ]
      },
      "ImportRequest": {
        "additionalProperties": false,
        "properties": {
          "doc_role": {
            "type": "string"
          },
          "language": {
            "type": "string"
          },
          "mode": {
            "enum": [
              "docx_numbered_lines",
              "txt_numbered_lines",
              "docx_paragraphs",
              "tei"
            ],
            "type": "string"
          },
          "path": {
            "type": "string"
          },
          "resource_type": {
            "type": "string"
          },
          "tei_unit": {
            "enum": [
              "p",
              "s"
            ],
            "type": "string"
          },
          "title": {
            "type": "string"
          }
        },
        "required": [
          "mode",
          "path"
        ],
        "type": "object"
      },
      "ImportResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "doc_id": {
                "type": "integer"
              },
              "mode": {
                "type": "string"
              },
              "run_id": {
                "type": "string"
              }
            },
            "required": [
              "run_id",
              "mode",
              "doc_id"
            ],
            "type": "object"
          }
        ]
      },
      "IndexResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "run_id": {
                "type": "string"
              },
              "units_indexed": {
                "type": "integer"
              }
            },
            "required": [
              "run_id",
              "units_indexed"
            ],
            "type": "object"
          }
        ]
      },
      "JobAcceptedResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "job": {
                "$ref": "#/components/schemas/JobRecord"
              }
            },
            "required": [
              "job"
            ],
            "type": "object"
          }
        ]
      },
      "JobCancelResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "job_id": {
                "type": "string"
              },
              "status": {
                "type": "string"
              }
            },
            "required": [
              "job_id",
              "status"
            ],
            "type": "object"
          }
        ]
      },
      "JobEnqueueRequest": {
        "properties": {
          "kind": {
            "enum": [
              "index",
              "curate",
              "validate-meta",
              "segment",
              "import",
              "align",
              "export_tei",
              "export_align_csv",
              "export_run_report"
            ],
            "type": "string"
          },
          "params": {
            "additionalProperties": true,
            "type": "object"
          }
        },
        "required": [
          "kind"
        ],
        "type": "object"
      },
      "JobRecord": {
        "additionalProperties": false,
        "properties": {
          "created_at": {
            "type": "string"
          },
          "error": {
            "type": "string"
          },
          "error_code": {
            "type": "string"
          },
          "finished_at": {
            "type": "string"
          },
          "job_id": {
            "type": "string"
          },
          "kind": {
            "type": "string"
          },
          "params": {
            "type": "object"
          },
          "progress_message": {
            "type": "string"
          },
          "progress_pct": {
            "maximum": 100,
            "minimum": 0,
            "type": "integer"
          },
          "result": {
            "type": "object"
          },
          "started_at": {
            "type": "string"
          },
          "status": {
            "enum": [
              "queued",
              "running",
              "done",
              "error"
            ],
            "type": "string"
          }
        },
        "required": [
          "job_id",
          "kind",
          "status",
          "progress_pct",
          "created_at"
        ],
        "type": "object"
      },
      "JobSubmitRequest": {
        "additionalProperties": false,
        "properties": {
          "kind": {
            "enum": [
              "index",
              "curate",
              "validate-meta",
              "segment"
            ],
            "type": "string"
          },
          "params": {
            "type": "object"
          }
        },
        "required": [
          "kind"
        ],
        "type": "object"
      },
      "JobsListResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "jobs": {
                "items": {
                  "$ref": "#/components/schemas/JobRecord"
                },
                "type": "array"
              }
            },
            "required": [
              "jobs"
            ],
            "type": "object"
          }
        ]
      },
      "QueryRequest": {
        "additionalProperties": false,
        "properties": {
          "aligned_limit": {
            "default": 20,
            "minimum": 1,
            "nullable": true,
            "type": "integer"
          },
          "all_occurrences": {
            "default": false,
            "type": "boolean"
          },
          "doc_id": {
            "type": "integer"
          },
          "doc_role": {
            "type": "string"
          },
          "include_aligned": {
            "default": false,
            "type": "boolean"
          },
          "language": {
            "type": "string"
          },
          "limit": {
            "default": 50,
            "maximum": 200,
            "minimum": 1,
            "type": "integer"
          },
          "mode": {
            "default": "segment",
            "enum": [
              "segment",
              "kwic"
            ],
            "type": "string"
          },
          "offset": {
            "default": 0,
            "minimum": 0,
            "type": "integer"
          },
          "q": {
            "type": "string"
          },
          "resource_type": {
            "type": "string"
          },
          "window": {
            "default": 10,
            "type": "integer"
          }
        },
        "required": [
          "q"
        ],
        "type": "object"
      },
      "QueryResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "count": {
                "type": "integer"
              },
              "has_more": {
                "type": "boolean"
              },
              "hits": {
                "items": {
                  "type": "object"
                },
                "type": "array"
              },
              "limit": {
                "type": "integer"
              },
              "next_offset": {
                "nullable": true,
                "type": "integer"
              },
              "offset": {
                "type": "integer"
              },
              "run_id": {
                "type": "string"
              },
              "total": {
                "nullable": true,
                "type": "integer"
              }
            },
            "required": [
              "run_id",
              "count",
              "hits",
              "limit",
              "offset",
              "next_offset",
              "has_more",
              "total"
            ],
            "type": "object"
          }
        ]
      },
      "SegmentRequest": {
        "additionalProperties": false,
        "properties": {
          "doc_id": {
            "type": "integer"
          },
          "lang": {
            "default": "und",
            "type": "string"
          },
          "pack": {
            "default": "auto",
            "enum": [
              "auto",
              "default",
              "fr_strict",
              "en_strict"
            ],
            "type": "string"
          }
        },
        "required": [
          "doc_id"
        ],
        "type": "object"
      },
      "SegmentResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "doc_id": {
                "type": "integer"
              },
              "fts_stale": {
                "type": "boolean"
              },
              "segment_pack": {
                "enum": [
                  "default",
                  "fr_strict",
                  "en_strict"
                ],
                "type": "string"
              },
              "units_input": {
                "type": "integer"
              },
              "units_output": {
                "type": "integer"
              },
              "warnings": {
                "items": {
                  "type": "string"
                },
                "type": "array"
              }
            },
            "required": [
              "fts_stale",
              "doc_id",
              "units_input",
              "units_output",
              "segment_pack",
              "warnings"
            ],
            "type": "object"
          }
        ]
      },
      "ShutdownResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "message": {
                "type": "string"
              },
              "shutting_down": {
                "type": "boolean"
              }
            },
            "required": [
              "shutting_down"
            ],
            "type": "object"
          }
        ]
      },
      "ValidateMetaRequest": {
        "additionalProperties": false,
        "properties": {
          "doc_id": {
            "type": "integer"
          }
        },
        "type": "object"
      },
      "ValidateMetaResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseResponse"
          },
          {
            "properties": {
              "docs_validated": {
                "type": "integer"
              },
              "results": {
                "items": {
                  "type": "object"
                },
                "type": "array"
              }
            },
            "required": [
              "docs_validated",
              "results"
            ],
            "type": "object"
          }
        ]
      }
    }
  },
  "info": {
    "description": "Localhost HTTP API for persistent corpus operations (query/index/import/etc.).",
    "title": "multicorpus_engine sidecar API",
    "version": "1.1.0",
    "x-contract-version": "1.1.0"
  },
  "openapi": "3.0.3",
  "paths": {
    "/align": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AlignRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AlignResponse"
                }
              }
            },
            "description": "Alignment reports"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Align documents by external_id, position, or similarity"
      }
    },
    "/align/audit": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AlignAuditRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AlignAuditResponse"
                }
              }
            },
            "description": "Alignment link audit page"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Paginated read-only audit of alignment links for a pivot/target pair"
      }
    },
    "/align/link/delete": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AlignLinkDeleteRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Deleted"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Delete an alignment link"
      }
    },
    "/align/link/retarget": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AlignLinkRetargetRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Retargeted"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Not found"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Change target unit of an alignment link"
      }
    },
    "/align/link/update_status": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AlignLinkUpdateStatusRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Not found"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Update status of an alignment link"
      }
    },
    "/align/quality": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AlignQualityRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AlignQualityResponse"
                }
              }
            },
            "description": "Alignment quality report"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Read-only alignment quality metrics for a pivot/target pair"
      }
    },
    "/curate": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CurateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CurateResponse"
                }
              }
            },
            "description": "Curation applied"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Apply curation rules"
      }
    },
    "/curate/preview": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CuratePreviewRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CuratePreviewResponse"
                }
              }
            },
            "description": "Preview result with stats and examples"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Preview curation rules without writing to DB (dry-run)"
      }
    },
    "/doc_relations": {
      "get": {
        "parameters": [
          {
            "in": "query",
            "name": "doc_id",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Relations"
          },
          "400": {
            "description": "Bad request"
          }
        },
        "summary": "List doc_relations for a document"
      }
    },
    "/doc_relations/delete": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "id": {
                    "type": "integer"
                  }
                },
                "required": [
                  "id"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Deleted"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Delete a doc_relation by id"
      }
    },
    "/doc_relations/set": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DocRelationSetRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Created or updated"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Upsert a doc_relation"
      }
    },
    "/documents": {
      "get": {
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DocumentsResponse"
                }
              }
            },
            "description": "Document list"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "List all documents in corpus"
      }
    },
    "/documents/bulk_update": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DocumentBulkUpdateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Bulk update document metadata"
      }
    },
    "/documents/update": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DocumentUpdateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Not found"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Update document metadata"
      }
    },
    "/export/align_csv": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExportAlignCsvRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "File written"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Export alignment links as CSV/TSV"
      }
    },
    "/export/run_report": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExportRunReportRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Report written"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Export run history as JSONL or HTML"
      }
    },
    "/export/tei": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExportTeiRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Files created"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Export documents as TEI XML"
      }
    },
    "/health": {
      "get": {
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            },
            "description": "Server is healthy"
          }
        },
        "summary": "Health check"
      }
    },
    "/import": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ImportRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImportResponse"
                }
              }
            },
            "description": "Import result"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Unauthorized (missing/invalid token)"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Import a document into corpus DB"
      }
    },
    "/index": {
      "post": {
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IndexResponse"
                }
              }
            },
            "description": "Index rebuilt"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Unauthorized (missing/invalid token)"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Rebuild FTS index"
      }
    },
    "/jobs": {
      "get": {
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobsListResponse"
                }
              }
            },
            "description": "Job list"
          }
        },
        "summary": "List async jobs"
      },
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JobSubmitRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobAcceptedResponse"
                }
              }
            },
            "description": "Accepted job"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          }
        },
        "summary": "Submit async job"
      }
    },
    "/jobs/enqueue": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JobEnqueueRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobAcceptedResponse"
                }
              }
            },
            "description": "Job accepted"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Enqueue an async job (token required; supports all kinds including import/align/exports)"
      }
    },
    "/jobs/{job_id}": {
      "get": {
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobAcceptedResponse"
                }
              }
            },
            "description": "Job status"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Job not found"
          }
        },
        "summary": "Get async job status"
      }
    },
    "/jobs/{job_id}/cancel": {
      "post": {
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobCancelResponse"
                }
              }
            },
            "description": "Job canceled"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Unauthorized"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Job not found"
          }
        },
        "security": [
          {
            "token": []
          }
        ],
        "summary": "Cancel a queued or running job (best-effort; idempotent)"
      }
    },
    "/openapi.json": {
      "get": {
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            },
            "description": "OpenAPI specification document"
          }
        },
        "summary": "OpenAPI contract"
      }
    },
    "/query": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/QueryRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QueryResponse"
                }
              }
            },
            "description": "Query result"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Run query"
      }
    },
    "/segment": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SegmentRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SegmentResponse"
                }
              }
            },
            "description": "Segmentation report"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Bad request"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Resegment document"
      }
    },
    "/shutdown": {
      "post": {
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ShutdownResponse"
                }
              }
            },
            "description": "Shutdown accepted"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Unauthorized (missing/invalid token)"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Gracefully stop sidecar process"
      }
    },
    "/validate-meta": {
      "post": {
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ValidateMetaRequest"
              }
            }
          },
          "required": false
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidateMetaResponse"
                }
              }
            },
            "description": "Validation report"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "description": "Internal error"
          }
        },
        "summary": "Validate metadata"
      }
    }
  },
  "servers": [
    {
      "url": "http://127.0.0.1:8765"
    }
  ]
}
